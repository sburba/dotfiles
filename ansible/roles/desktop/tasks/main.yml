- include: chrome.yml
- include: zsh.yml
- name: Add required copr repositories
  become: yes
  command: dnf copr enable -y {{ item }}
  args:
    # Ansible dnf doesn't support copr
    # See https://github.com/ansible/ansible/issues/26673
    warn: no
  with_items:
    - thofmann/rofi
    - axeld/compton
    - dperson/neovim
- name: Install Packages
  become: yes
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - neovim
    - git
    - xclip
    - thefuck
    # ansible needs this for dconf plugin
    - python2-psutil
    # Desktop environment
    - i3
    - i3lock
    - compton
    - rofi
    - feh
    # Catch laptop lid close/open
    - acpid
    # To manage dotfiles
    - stow
    # Enpass dependencies
    - libXScrnSaver
    - lsof
- name: Remove unused base packages
  become: yes
  package:
    name: "{{ item }}"
    state: absent
    autoremove: yes
  with_items:
    - libreoffice-calc
    - libreoffice-draw
    - libreoffice-impress
    - libreoffice-math
    - libreoffice-writer
    - libreoffice-core
    - libreofficekit
- name: Find dotfiles
  register: files_matched
  find:
    paths: ./stowables
    file_type: directory
- name: Lay down dotfiles
  command: stow {{ item | basename }} --target={{ ansible_env.HOME }}
  args:
    chdir: stowables
  with_items: "{{ files_matched | json_query('files[*].path') }}"
